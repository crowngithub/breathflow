<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ¯é“ - ä¸¹ç”°å‘¼å¸ AI è®­ç»ƒå™¨</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="æ¯é“">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#010204">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#010204] m-0 p-0 overflow-hidden text-slate-200 font-sans antialiased">
<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;

    const APP_VERSION = "2.0.0";
    const DEFAULT_BASE_URL = "https://generativelanguage.googleapis.com";

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // æ ¸å¿ƒä¿®å¤ï¼šåŠ¨æ€ç”Ÿæˆä¸€ä¸ª"è¿‘é™éŸ³ä½†éé›¶"çš„ WAV ä¿æ´»éŸ³é¢‘
    // iOS é€šè¿‡éŸ³é¢‘å†…å®¹å¹…åº¦åˆ¤æ–­æ˜¯å¦ç»™äºˆåå°æƒé™ï¼Œçº¯é™éŸ³ä¼šè¢«æ‹’ç»
    // 40Hz æ­£å¼¦æ³¢ï¼Œå¹…åº¦ 0.08%ï¼ˆäººè€³å‡ ä¹å¬ä¸åˆ°ï¼Œä½† iOS è®¤ä¸ºæ˜¯æ´»è·ƒéŸ³é¢‘ï¼‰
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function buildKeepAliveURL() {
        const sampleRate = 22050;
        const numSamples = sampleRate; // 1ç§’å¾ªç¯
        const buf = new ArrayBuffer(44 + numSamples * 2);
        const v = new DataView(buf);
        const ws = (off, s) => { for (let i = 0; i < s.length; i++) v.setUint8(off + i, s.charCodeAt(i)); };
        ws(0, 'RIFF');
        v.setUint32(4, 36 + numSamples * 2, true);
        ws(8, 'WAVE'); ws(12, 'fmt ');
        v.setUint32(16, 16, true); v.setUint16(20, 1, true); v.setUint16(22, 1, true);
        v.setUint32(24, sampleRate, true); v.setUint32(28, sampleRate * 2, true);
        v.setUint16(32, 2, true); v.setUint16(34, 16, true);
        ws(36, 'data'); v.setUint32(40, numSamples * 2, true);
        for (let i = 0; i < numSamples; i++) {
            // 40Hzï¼Œå¹…åº¦ 26 / 32767 â‰ˆ 0.08%ï¼Œè¶³ä»¥æ¿€æ´» iOS éŸ³é¢‘ä¼šè¯
            const sample = Math.sin(2 * Math.PI * 40 * i / sampleRate) * 26;
            v.setInt16(44 + i * 2, sample, true);
        }
        return URL.createObjectURL(new Blob([buf], { type: 'audio/wav' }));
    }

    const KEEP_ALIVE_URL = buildKeepAliveURL();

    const Icon = ({ name, size = 24, className = "" }) => {
        const icons = {
            Play: <path d="m5 3 14 9-14 9V3z"/>,
            Pause: <><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></>,
            RotateCcw: <><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></>,
            Settings: <><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></>,
            Volume2: <><path d="M11 5L6 9H2v6h4l5 4V5z"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></>,
            VolumeX: <><path d="M11 5L6 9H2v6h4l5 4V5z"/><line x1="23" y1="9" x2="17" y2="15"/><line x1="17" y1="9" x2="23" y2="15"/></>,
            Plus: <path d="M12 5v14M5 12h14" />,
            Minus: <path d="M5 12h14" />,
            Clock: <><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></>,
            Waves: <><path d="M2 6c.6.5 1.2 1 2.5 1s2.5-1 4-1 2.6 1 4 1 2.5-1 4-1 2.5 1 4 1"/><path d="M2 12c.6.5 1.2 1 2.5 1s2.5-1 4-1 2.6 1 4 1 2.5-1 4-1 2.5 1 4 1"/><path d="M2 18c.6.5 1.2 1 2.5 1s2.5-1 4-1 2.6 1 4 1 2.5-1 4-1 2.5 1 4 1"/></>,
            CloudRain: <path d="M20 16.2A4.5 4.5 0 0 0 17.5 8h-1.8A7 7 0 1 0 4 14.9M12 18v4M8 18v2M16 18v2"/>,
            Bell: <><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></>,
            Drum: <path d="M12 2v20M5 7l14 10M5 17l14-10" />,
            Droplets: <path d="M7 16.3c2.2 0 4-1.8 4-4 0-3.3-4-8-4-8s-4 4.7-4 8c0 2.2 1.8 4 4 4Z" />,
            Ban: <><circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/></>,
            Sparkles: <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/>,
            Shield: <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>,
            Zap: <path d="M13 2 L3 14 L12 14 L11 22 L21 10 L12 10 L13 2 Z"/>,
            Check: <path d="M20 6 9 17l-5-5"/>,
            RotateCw: <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/>,
            Wind: <path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2M9.6 4.6A2 2 0 1 1 11 8H2M12.6 19.4A2 2 0 1 0 14 16H2" />
        };
        return (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24"
                 fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"
                 className={className}>
                {icons[name] || <circle cx="12" cy="12" r="10"/>}
            </svg>
        );
    };

    const easeInOutSine = (x) => -(Math.cos(Math.PI * x) - 1) / 2;

    const App = () => {
        const [isActive, setIsActive] = useState(false);
        const [phase, setPhase] = useState('ready');
        const [settings, setSettings] = useState({
            inhale: 4, hold: 0, exhale: 4,
            volume: 0.4,
            bgType: 'none',
            transitionSound: 'qing',
            runMode: 'background',
            vibrationEnabled: true,
            apiProxyUrl: DEFAULT_BASE_URL
        });
        const [elapsedTime, setElapsedTime] = useState(0);
        const [displayProgress, setDisplayProgress] = useState(0);
        const [showSettings, setShowSettings] = useState(false);
        const [showAI, setShowAI] = useState(false);
        const [userMood, setUserMood] = useState("");
        const [isAIThinking, setIsAIThinking] = useState(false);
        const [aiSuggestion, setAiSuggestion] = useState(null);
        const [updateToast, setUpdateToast] = useState(false);
        const [bgStatus, setBgStatus] = useState('idle'); // idle | active | warning

        const audioCtxRef = useRef(null);
        const whiteGainRef = useRef(null);
        const brownGainRef = useRef(null);
        const bgFilterRef = useRef(null);
        const modGainRef = useRef(null);
        const keepAliveOscRef = useRef(null);   // â˜… Web Audio ä¿æ´»æŒ¯è¡å™¨
        const keepAliveGainRef = useRef(null);  // â˜… ä¿æ´»å¢ç›Šï¼ˆæä½éŸ³é‡ï¼‰
        const animationFrameRef = useRef(null);
        const wakeLockRef = useRef(null);
        const nextScheduleTimeRef = useRef(0);
        const cycleStartTimeAudioRef = useRef(0);
        const keepAliveAudioTagRef = useRef(null);
        const isActiveRef = useRef(isActive);

        useEffect(() => { isActiveRef.current = isActive; }, [isActive]);

        // ç‰ˆæœ¬æ£€æµ‹
        useEffect(() => {
            const lastVersion = localStorage.getItem('breathflow_version');
            if (lastVersion && lastVersion !== APP_VERSION) {
                setUpdateToast(true);
                setTimeout(() => setUpdateToast(false), 5000);
            }
            localStorage.setItem('breathflow_version', APP_VERSION);
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('./sw.js').catch(() => {});
            }
        }, []);

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // â˜… å…³é”®ä¿®å¤ 1ï¼šç›‘å¬ visibilitychangeï¼Œè§£é”åç«‹åˆ»æ¢å¤ AudioContext
        //   iOS é”å± â†’ è§£é”æ—¶ï¼ŒAudioContext ä¼šè¿›å…¥ suspended çŠ¶æ€
        //   å¿…é¡»åœ¨ç”¨æˆ·é‡æ–°å¯è§æ—¶ä¸»åŠ¨ resumeï¼Œå¦åˆ™è®¡æ—¶æ°¸ä¹…åœæ­¢
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        useEffect(() => {
            const handleVisibility = () => {
                if (document.visibilityState === 'visible') {
                    const ctx = audioCtxRef.current;
                    if (ctx && ctx.state === 'suspended') {
                        ctx.resume().then(() => {
                            // é‡æ–°æ ¡å‡†è®¡æ—¶èµ·ç‚¹ï¼Œé¿å…è§£é”åè·³å¸§
                            // é€šè¿‡ elapsedTime æ¨ç®—å½“å‰åº”å¤„äºå“ªä¸ªé˜¶æ®µ
                        }).catch(console.error);
                    }
                    // æ¢å¤ä¿æ´»éŸ³é¢‘
                    if (keepAliveAudioTagRef.current && isActiveRef.current) {
                        keepAliveAudioTagRef.current.play().catch(() => {});
                    }
                }
            };
            document.addEventListener('visibilitychange', handleVisibility);
            return () => document.removeEventListener('visibilitychange', handleVisibility);
        }, []);

        const scheduleTone = useCallback((time) => {
            if (settings.transitionSound === 'none' || !audioCtxRef.current) return;
            const ctx = audioCtxRef.current;
            const vol = settings.volume;
            const createOsc = (freq, dur, tTime, reso = false) => {
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(freq, tTime);
                if (reso) osc.frequency.exponentialRampToValueAtTime(freq * 0.98, tTime + dur);
                gain.gain.setValueAtTime(0, tTime);
                gain.gain.linearRampToValueAtTime(vol * 0.5, tTime + 0.005);
                gain.gain.exponentialRampToValueAtTime(0.001, tTime + dur);
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.start(tTime);
                osc.stop(tTime + dur);
            };
            if (settings.transitionSound === 'muyu') createOsc(750, 0.12, time);
            else if (settings.transitionSound === 'qing') createOsc(220, 2.0, time, true);
            else if (settings.transitionSound === 'drop') {
                const o = ctx.createOscillator();
                const g = ctx.createGain();
                o.frequency.setValueAtTime(800, time);
                o.frequency.exponentialRampToValueAtTime(1600, time + 0.05);
                o.frequency.exponentialRampToValueAtTime(400, time + 0.15);
                g.gain.setValueAtTime(0, time);
                g.gain.linearRampToValueAtTime(vol * 0.3, time + 0.002);
                g.gain.exponentialRampToValueAtTime(0.001, time + 0.2);
                o.connect(g);
                g.connect(ctx.destination);
                o.start(time);
                o.stop(time + 0.2);
            }
        }, [settings.transitionSound, settings.volume]);

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // â˜… å…³é”®ä¿®å¤ 2ï¼šWeb Audio ä¿æ´»æŒ¯è¡å™¨
        //   åœ¨ AudioContext å†…åˆ›å»ºä¸€ä¸ª 40Hz æŒ¯è¡å™¨ï¼Œå¢ç›Š 0.001
        //   è¿™è®© iOS è®¤ä¸º Web Audio æœ‰"çœŸå®è¾“å‡º"ï¼Œä¸æŒ‚èµ· JS çº¿ç¨‹
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const startKeepAliveOscillator = (ctx) => {
            if (keepAliveOscRef.current) return;
            try {
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.type = 'sine';
                osc.frequency.value = 40;          // 40Hz â€” äººè€³ä¸´ç•Œå€¼ä»¥ä¸‹
                gain.gain.value = 0.001;           // å¹…åº¦ 0.1%ï¼Œå‡ ä¹å¬ä¸åˆ°
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.start();
                keepAliveOscRef.current = osc;
                keepAliveGainRef.current = gain;
            } catch (e) { console.error('keep-alive osc error', e); }
        };

        const stopKeepAliveOscillator = () => {
            if (keepAliveOscRef.current) {
                try { keepAliveOscRef.current.stop(); } catch (_) {}
                keepAliveOscRef.current = null;
                keepAliveGainRef.current = null;
            }
        };

        const handleStartSession = async () => {
            if (isActive) {
                setIsActive(false);
                setBgStatus('idle');
                stopKeepAliveOscillator();
                if (keepAliveAudioTagRef.current) keepAliveAudioTagRef.current.pause();
                if (wakeLockRef.current) { wakeLockRef.current.release(); wakeLockRef.current = null; }
                if ('mediaSession' in navigator) navigator.mediaSession.playbackState = 'paused';
                return;
            }

            // 1. åˆå§‹åŒ– / æ¢å¤ Web Audio Context
            if (!audioCtxRef.current) {
                try {
                    const ctx = new (window.AudioContext || window.webkitAudioContext)();
                    audioCtxRef.current = ctx;
                    const bufferSize = 2 * ctx.sampleRate;
                    const whiteBuffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
                    const brownBuffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
                    const wD = whiteBuffer.getChannelData(0);
                    const bD = brownBuffer.getChannelData(0);
                    let lastOut = 0;
                    for (let i = 0; i < bufferSize; i++) {
                        wD[i] = Math.random() * 2 - 1;
                        const white = Math.random() * 2 - 1;
                        bD[i] = (lastOut + (0.02 * white)) / 1.002;
                        lastOut = bD[i];
                        bD[i] *= 3.5;
                    }
                    const wSrc = ctx.createBufferSource(); wSrc.buffer = whiteBuffer; wSrc.loop = true;
                    const bSrc = ctx.createBufferSource(); bSrc.buffer = brownBuffer; bSrc.loop = true;
                    const filter = ctx.createBiquadFilter(); filter.type = 'lowpass';
                    const wGain = ctx.createGain(); const bGain = ctx.createGain();
                    const modGain = ctx.createGain();
                    wGain.gain.value = 0; bGain.gain.value = 0;
                    wSrc.connect(wGain); bSrc.connect(bGain);
                    wGain.connect(modGain); bGain.connect(modGain);
                    modGain.connect(filter); filter.connect(ctx.destination);
                    wSrc.start(); bSrc.start();
                    whiteGainRef.current = wGain;
                    brownGainRef.current = bGain;
                    bgFilterRef.current = filter;
                    modGainRef.current = modGain;
                } catch (e) { console.error(e); }
            } else if (audioCtxRef.current.state === 'suspended') {
                await audioCtxRef.current.resume();
            }

            // â˜… 2. å¯åŠ¨ Web Audio ä¿æ´»æŒ¯è¡å™¨ï¼ˆåœ¨ AudioContext å†…æŒç»­å‘å‡ºä½é¢‘ä¿¡å·ï¼‰
            startKeepAliveOscillator(audioCtxRef.current);

            // â˜… 3. å¯åŠ¨ HTML Audio æ ‡ç­¾ä¿æ´»ï¼ˆåŒé‡ä¿é™©ï¼šä¸¤æ¡é€šè·¯è‡³å°‘ä¸€æ¡èƒ½ç»•è¿‡ iOS é™åˆ¶ï¼‰
            //   ä½¿ç”¨åŠ¨æ€ç”Ÿæˆçš„éé™éŸ³ WAVï¼Œç¡®ä¿ iOS æˆäºˆåå°éŸ³é¢‘æƒé™
            if (keepAliveAudioTagRef.current) {
                keepAliveAudioTagRef.current.volume = 0.01; // 1% éŸ³é‡ï¼Œå‡ ä¹å¬ä¸åˆ°
                try {
                    await keepAliveAudioTagRef.current.play();
                } catch (e) {
                    console.warn('Audio tag play blocked (will retry on user interaction):', e);
                }
            }

            // 4. å±å¹•å¸¸äº®é”ï¼ˆwakelock æ¨¡å¼ï¼‰
            if ('wakeLock' in navigator && settings.runMode === 'wakelock') {
                try { wakeLockRef.current = await navigator.wakeLock.request('screen'); } catch (_) {}
            }

            // 5. Media Session â€”â€” è®©æ§åˆ¶ä¸­å¿ƒå’Œé”å±æ˜¾ç¤ºåª’ä½“æ§ä»¶ï¼Œä½¿ iOS è®¤ä¸ºè¿™æ˜¯åª’ä½“ App
            if ('mediaSession' in navigator) {
                navigator.mediaSession.playbackState = 'playing';
                navigator.mediaSession.metadata = new MediaMetadata({
                    title: 'æ¯é“ Â· å‘¼å¸è®­ç»ƒ',
                    artist: 'ä¸¹ç”°å‘¼å¸ç»ƒä¹ ',
                    album: 'æ­£åœ¨è¿›è¡Œä¸­'
                });
                navigator.mediaSession.setActionHandler('play', () => {});
                navigator.mediaSession.setActionHandler('pause', () => {});
            }

            setBgStatus('active');
            setIsActive(true);
        };

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // â˜… å…³é”®ä¿®å¤ 3ï¼šè°ƒåº¦å™¨æå‰é‡ä» 1.5s æé«˜åˆ° 3s
        //   iOS åœ¨è¿›å…¥å‡†é”å±è¾¹ç¼˜æ—¶ JS æ‰§è¡Œé¢‘ç‡ä¼šä¸‹é™
        //   æ›´å¤§çš„æå‰é‡ç¡®ä¿éŸ³é¢‘äº‹ä»¶æ—©å·²è¿›å…¥ç¡¬ä»¶ç®¡é“
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        useEffect(() => {
            if (!isActive) return;
            const ctx = audioCtxRef.current;
            if (!ctx) return;
            cycleStartTimeAudioRef.current = ctx.currentTime;
            nextScheduleTimeRef.current = ctx.currentTime;

            const scheduler = setInterval(() => {
                const cCtx = audioCtxRef.current;
                if (!isActiveRef.current || !cCtx) return;
                // å¦‚æœ AudioContext è¢«æš‚åœï¼ˆé”å±ï¼‰ï¼Œç«‹å³å°è¯•æ¢å¤
                if (cCtx.state === 'suspended') {
                    cCtx.resume().catch(() => {});
                    return;
                }
                const now = cCtx.currentTime;
                const totalSec = settings.inhale + settings.hold + settings.exhale;
                // æå‰ 3 ç§’é¢„åŠ è½½ï¼Œåº”å¯¹ iOS èŠ‚æµ
                while (nextScheduleTimeRef.current < now + 3.0) {
                    scheduleTone(nextScheduleTimeRef.current);
                    const elapsed = (nextScheduleTimeRef.current - cycleStartTimeAudioRef.current) % totalSec;
                    const iS = settings.inhale, hS = settings.hold;
                    let nextIn;
                    if (elapsed < iS - 0.01) nextIn = iS - elapsed;
                    else if (elapsed < iS + hS - 0.01) nextIn = (iS + hS) - elapsed;
                    else nextIn = totalSec - elapsed;
                    nextScheduleTimeRef.current += Math.max(nextIn, 0.1);
                }
            }, 100);
            return () => clearInterval(scheduler);
        }, [isActive, settings.inhale, settings.hold, settings.exhale, scheduleTone]);

        // æ¸²æŸ“åŠ¨ç”»ï¼ˆé”å±ååœæ­¢æ­£å¸¸ï¼Œè§£é”åè‡ªåŠ¨æ¢å¤ï¼‰
        useEffect(() => {
            if (!isActive) return;
            const animate = () => {
                const ctx = audioCtxRef.current;
                if (!isActiveRef.current || !ctx) return;
                if (ctx.state === 'suspended') {
                    // é”å±ä¸­ï¼šæš‚åœæ¸²æŸ“ï¼Œç­‰å¾…æ¢å¤
                    animationFrameRef.current = requestAnimationFrame(animate);
                    return;
                }
                const total = settings.inhale + settings.hold + settings.exhale;
                const elapsed = (ctx.currentTime - cycleStartTimeAudioRef.current) % total;
                let cPh = 'inhale', cPr = 0;
                const i = settings.inhale, h = settings.hold, e = settings.exhale;
                if (elapsed < i) { cPh = 'inhale'; cPr = elapsed / i; }
                else if (elapsed < i + h) { cPh = 'hold'; cPr = (elapsed - i) / h; }
                else { cPh = 'exhale'; cPr = e > 0 ? (elapsed - i - h) / e : 1; }
                setPhase(cPh);
                setDisplayProgress(cPr);
                const now = ctx.currentTime;
                let wG = 0, bG = 0, freq = 600, mG = 1.0;
                switch (settings.bgType) {
                    case 'rain': wG = settings.volume * 0.35; bG = settings.volume * 0.1; freq = 1500; mG = 0.8 + Math.random() * 0.4; break;
                    case 'wind': bG = settings.volume * 0.5 * (0.9 + Math.sin(now * 0.3) * 0.1); freq = 300 + Math.sin(now * 0.2) * 100; break;
                    case 'white': wG = settings.volume * 0.25; freq = 1800; break;
                }
                if (whiteGainRef.current) whiteGainRef.current.gain.setTargetAtTime(wG, now, 0.5);
                if (brownGainRef.current) brownGainRef.current.gain.setTargetAtTime(bG, now, 0.5);
                if (bgFilterRef.current) bgFilterRef.current.frequency.setTargetAtTime(freq, now, 0.5);
                if (modGainRef.current) modGainRef.current.gain.setTargetAtTime(mG, now, 0.05);
                animationFrameRef.current = requestAnimationFrame(animate);
            };
            animationFrameRef.current = requestAnimationFrame(animate);
            return () => cancelAnimationFrame(animationFrameRef.current);
        }, [isActive, settings.inhale, settings.hold, settings.exhale, settings.bgType, settings.volume]);

        useEffect(() => {
            let t;
            if (isActive) t = setInterval(() => setElapsedTime(p => p + 1), 1000);
            return () => clearInterval(t);
        }, [isActive]);

        const callGemini = async (prompt, sys) => {
            let delay = 1000;
            const url = `${settings.apiProxyUrl}/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent`;
            for (let i = 0; i < 5; i++) {
                try {
                    const res = await fetch(url, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            systemInstruction: { parts: [{ text: sys }] },
                            generationConfig: { responseMimeType: "application/json" }
                        })
                    });
                    const data = await res.json();
                    return JSON.parse(data.candidates[0].content.parts[0].text);
                } catch (err) {
                    if (i === 4) throw err;
                    await new Promise(r => setTimeout(r, delay));
                    delay *= 2;
                }
            }
        };

        const generateAISuggestion = async () => {
            if (!userMood) return;
            setIsAIThinking(true);
            try {
                const res = await callGemini(
                    `å½“å‰æ„Ÿå—: ${userMood}`,
                    "ä½ æ˜¯ä¸€ä½ç¦…ä¿®å¤§å¸ˆã€‚å»ºè®®å‘¼å¸å‚æ•° JSON: { inhale:æ•°å­—, hold:æ•°å­—, exhale:æ•°å­—, wisdom:çŸ­å¼•å¯¼è¯­ }ã€‚å»ºè®®æ—¶é•¿3-12ç§’ã€‚"
                );
                setAiSuggestion(res);
            } catch (e) { console.error(e); } finally { setIsAIThinking(false); }
        };

        const adjustAll = (d) => {
            setSettings(s => ({ ...s, inhale: Math.max(1, s.inhale + d), exhale: Math.max(1, s.exhale + d) }));
        };

        const forceFullReload = async () => {
            try {
                if ('serviceWorker' in navigator) {
                    const regs = await navigator.serviceWorker.getRegistrations();
                    for (let reg of regs) await reg.unregister();
                }
                if ('caches' in window) {
                    const keys = await caches.keys();
                    for (let key of keys) await caches.delete(key);
                }
                localStorage.removeItem('breathflow_version');
                window.location.href = window.location.origin + window.location.pathname + '?sync=' + Date.now();
            } catch (e) { window.location.reload(true); }
        };

        const { scale, color, opacity } = (() => {
            const sP = easeInOutSine(displayProgress);
            let s = 1, c = 'rgb(59, 130, 246)', o = 0.1;
            if (phase === 'inhale') { s = 1 + sP * 0.85; c = 'rgb(59, 130, 246)'; o = 0.1 + sP * 0.4; }
            else if (phase === 'hold') { s = 1.85; c = 'rgb(52, 211, 153)'; o = 0.5; }
            else if (phase === 'exhale') { s = 1.85 - sP * 0.85; c = 'rgb(244, 63, 94)'; o = 0.5 - sP * 0.4; }
            return { scale: s, color: c, opacity: o };
        })();

        return (
            <div className="min-h-screen bg-[#010204] text-slate-200 flex flex-col items-center justify-between p-6 overflow-hidden select-none font-sans antialiased">

                {/* â˜… ä¿æ´»éŸ³é¢‘æ ‡ç­¾ï¼šä½¿ç”¨åŠ¨æ€ç”Ÿæˆçš„éé™éŸ³ WAV */}
                <audio
                    ref={keepAliveAudioTagRef}
                    src={KEEP_ALIVE_URL}
                    loop
                    playsInline
                    preload="auto"
                    style={{ display: 'none' }}
                />

                {updateToast && (
                    <div className="fixed top-12 left-1/2 -translate-x-1/2 z-[200] bg-blue-600 text-white px-6 py-3 rounded-2xl shadow-2xl flex items-center gap-3 animate-in fade-in">
                        <Icon name="Check" size={18}/>
                        <div className="flex flex-col text-left">
                            <span className="text-sm font-bold tracking-wide">ç‰ˆæœ¬ v{APP_VERSION} å·²æ¿€æ´»</span>
                            <span className="text-[10px] opacity-80">iOS åŒé€šé“åå°ä¿æ´»</span>
                        </div>
                    </div>
                )}

                <div className="w-full max-w-lg flex justify-between items-center z-20 pt-10 px-4">
                    <div className="flex flex-col">
                        <h1 className="text-2xl font-extralight tracking-[0.4em] text-white">æ¯é“</h1>
                        <div className="flex items-center gap-2 mt-1">
                            <div className={`w-1.5 h-1.5 rounded-full transition-colors ${isActive ? 'bg-green-400 animate-pulse' : 'bg-slate-600'}`}></div>
                            <span className="text-[10px] text-slate-500 tracking-widest uppercase font-medium">
                                {isActive ? 'Dual Keep-Alive âœ“' : 'Standby'}
                            </span>
                        </div>
                    </div>
                    <div className="flex items-center gap-3">
                        <button onClick={() => setShowAI(true)} className="p-3 bg-blue-600/20 border border-blue-500/30 rounded-2xl text-blue-400 active:scale-95 shadow-lg"><Icon name="Sparkles" size={20}/></button>
                        <button onClick={() => setShowSettings(true)} className="p-3 bg-white/5 rounded-2xl text-slate-400 active:scale-95 shadow-lg"><Icon name="Settings" size={20}/></button>
                    </div>
                </div>

                <div className="relative flex flex-col items-center justify-center flex-1 w-full scale-90 md:scale-100">
                    {isActive && (
                        <div className="absolute top-0 flex items-center gap-2 bg-blue-500/10 px-4 py-2 rounded-xl text-[9px] text-blue-400/80 tracking-widest uppercase animate-pulse z-30">
                            <Icon name={settings.runMode === 'wakelock' ? "Zap" : "Shield"} size={10}/>
                            {settings.runMode === 'wakelock' ? "å±å¹•å¸¸äº® + éŸ³é¢‘ä¿æ´»" : "é”å±å­˜æ´» Â· åŒé€šé“éŸ³é¢‘"}
                        </div>
                    )}
                    <div className="absolute w-[500px] h-[500px] rounded-full blur-[100px] transition-all duration-1000"
                         style={{ backgroundColor: color, opacity: opacity * 0.3 }}></div>
                    <div className="relative" style={{ transform: `scale(${scale})`, transition: 'transform 0.1s linear' }}>
                        <div className="w-48 h-48 md:w-64 md:h-64 rounded-full border-[1.5px] flex items-center justify-center bg-black/40 backdrop-blur-md transition-colors duration-1000 shadow-2xl"
                             style={{ borderColor: `${color}${isActive ? '' : '33'}` }}>
                            <span className="text-4xl font-extralight tracking-[0.6em] transition-all duration-1000 ml-3"
                                  style={{ color: color, opacity: isActive ? 1 : 0.3 }}>
                                {phase === 'ready' ? 'é™' : phase === 'inhale' ? 'å¸' : phase === 'hold' ? 'æ­¢' : 'å‘¼'}
                            </span>
                        </div>
                    </div>

                    <div className="mt-16 flex flex-col items-center gap-6 z-10 w-full">
                        <div className="flex items-center gap-8 bg-white/[0.03] p-1.5 px-4 rounded-full border border-white/5 backdrop-blur-sm shadow-inner transition-all hover:bg-white/5">
                            <button onClick={() => adjustAll(-1)} className="p-2 text-slate-500 active:scale-75"><Icon name="Minus" size={20}/></button>
                            <div className="flex flex-col items-center min-w-[100px]">
                                <span className="text-[10px] uppercase tracking-widest text-slate-600 mb-0.5 font-bold">å‘¼å¸å‘¨æœŸ</span>
                                <span className="text-lg font-light tabular-nums text-blue-400">{settings.inhale}s <span className="text-slate-600">/</span> {settings.exhale}s</span>
                            </div>
                            <button onClick={() => adjustAll(1)} className="p-2 text-slate-500 active:scale-75"><Icon name="Plus" size={20}/></button>
                        </div>
                        <div className="text-center px-4 max-w-xs text-slate-500 text-[10px] tracking-[0.3em] uppercase leading-relaxed h-8">
                            {phase === 'ready' ? (aiSuggestion ? aiSuggestion.wisdom : "ç¥å®šä¸¹ç”°ï¼Œæ„éšæ¯è½¬") : `å½“å‰é˜¶æ®µï¼š${phase === 'inhale' ? 'å¸æ°”' : phase === 'hold' ? 'å±æ¯' : 'å‘¼æ°”'}`}
                        </div>
                    </div>
                </div>

                <div className="w-full max-w-md space-y-6 z-20 mb-6 px-6">
                    <div className="flex flex-col gap-2">
                        <div className="flex justify-between items-center px-2">
                            <span className="text-[9px] text-slate-600 uppercase tracking-widest">Master Volume</span>
                            <span className="font-mono text-[9px] text-slate-500 tabular-nums">{Math.round(settings.volume * 100)}%</span>
                        </div>
                        <div className="flex items-center gap-4">
                            <Icon name={settings.volume > 0 ? "Volume2" : "VolumeX"} size={16} className="text-slate-600"/>
                            <input type="range" min="0" max="1" step="0.01" value={settings.volume}
                                   onChange={(e) => setSettings(s => ({ ...s, volume: parseFloat(e.target.value) }))}
                                   className="w-full h-[3px] bg-white/10 rounded-full appearance-none accent-blue-500 shadow-inner"
                                   style={{ background: `linear-gradient(to right, #3b82f6 ${settings.volume * 100}%, rgba(255,255,255,0.1) ${settings.volume * 100}%)` }}/>
                        </div>
                    </div>

                    <div className="bg-white/[0.03] backdrop-blur-2xl border border-white/10 rounded-[2.5rem] p-4 flex items-center justify-around shadow-2xl">
                        <button onClick={() => {
                            setIsActive(false);
                            setElapsedTime(0);
                            setPhase('ready');
                            setBgStatus('idle');
                            stopKeepAliveOscillator();
                            if (keepAliveAudioTagRef.current) keepAliveAudioTagRef.current.pause();
                        }} className="p-4 rounded-full bg-white/5 text-slate-500 active:scale-90">
                            <Icon name="RotateCcw" size={22}/>
                        </button>
                        <button onClick={handleStartSession}
                                className={`p-8 rounded-full transition-all active:scale-95 shadow-2xl relative ${isActive ? 'bg-white text-black' : 'bg-blue-600 text-white shadow-blue-600/30'}`}>
                            <Icon name={isActive ? "Pause" : "Play"} size={32} className={isActive ? "" : "ml-1"}/>
                            {!isActive && <div className="absolute inset-0 rounded-full border border-blue-400 animate-ping opacity-20"></div>}
                        </button>
                        <div className="flex items-center gap-2 bg-white/5 px-4 py-2 rounded-full border border-white/10">
                            <Icon name="Clock" size={12} className="text-slate-500"/>
                            <span className="font-mono text-xs tabular-nums">
                                {Math.floor(elapsedTime / 60).toString().padStart(2, '0')}:{(elapsedTime % 60).toString().padStart(2, '0')}
                            </span>
                        </div>
                    </div>
                </div>

                {/* AI é¢æ¿ */}
                {showAI && (
                    <div className="fixed inset-0 bg-black/95 backdrop-blur-xl z-[110] flex items-center justify-center p-6 animate-in">
                        <div className="bg-slate-900/90 w-full max-w-sm rounded-[2.5rem] border border-white/10 p-8 space-y-6 shadow-2xl overflow-y-auto max-h-[90vh]">
                            <div className="flex justify-between items-center mb-2">
                                <div className="flex items-center gap-2">
                                    <Icon name="Sparkles" size={16} className="text-blue-400"/>
                                    <h3 className="text-sm font-medium tracking-widest uppercase text-white">AI æ¯é“æ™ºå¼•</h3>
                                </div>
                                <button onClick={() => setShowAI(false)} className="text-[10px] text-slate-500 uppercase">å…³é—­</button>
                            </div>
                            <div className="space-y-4">
                                <textarea value={userMood} onChange={(e) => setUserMood(e.target.value)}
                                          placeholder="æè¿°å¿ƒå¢ƒ..." className="w-full bg-white/5 border border-white/10 rounded-2xl p-4 text-sm font-light h-24 outline-none focus:border-blue-500/50 transition-all text-white placeholder:text-slate-600"/>
                                <button onClick={generateAISuggestion} disabled={isAIThinking || !userMood}
                                        className="w-full bg-blue-600 text-white rounded-2xl py-4 text-xs font-bold uppercase tracking-widest shadow-lg active:scale-95 disabled:opacity-50 transition-all flex items-center justify-center gap-2">
                                    {isAIThinking ? <div className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div> : "âœ¨ å¼€å¯æ™ºå¼•"}
                                </button>
                            </div>
                            {aiSuggestion && (
                                <div className="pt-6 border-t border-white/5 space-y-4 animate-in">
                                    <div className="bg-blue-600/10 border border-blue-500/20 rounded-2xl p-4">
                                        <p className="text-[10px] text-blue-400 uppercase mb-1">å»ºè®®é¢‘ç‡</p>
                                        <p className="text-base font-light tabular-nums">å¸ {aiSuggestion.inhale}s / å± {aiSuggestion.hold}s / å‘¼ {aiSuggestion.exhale}s</p>
                                    </div>
                                    <button onClick={() => {
                                        setSettings(p => ({ ...p, inhale: aiSuggestion.inhale, hold: aiSuggestion.hold, exhale: aiSuggestion.exhale }));
                                        setShowAI(false);
                                    }} className="w-full bg-white text-black rounded-2xl py-4 text-xs font-bold uppercase tracking-widest active:scale-95 transition-all">åŒæ­¥è‡³è®­ç»ƒ</button>
                                </div>
                            )}
                        </div>
                    </div>
                )}

                {/* è®¾ç½®é¢æ¿ */}
                {showSettings && (
                    <div className="fixed inset-0 bg-black/95 backdrop-blur-xl z-[100] flex items-center justify-center p-6 animate-in">
                        <div className="bg-slate-900/90 w-full max-w-sm rounded-[2.5rem] border border-white/10 p-8 space-y-6 shadow-2xl max-h-[90vh] overflow-y-auto">
                            <div className="flex justify-between items-center mb-4 sticky top-0 bg-transparent z-10">
                                <h3 className="text-sm font-medium tracking-widest uppercase text-white">ä¸“ä¸šé…ç½®</h3>
                                <button onClick={() => setShowSettings(false)} className="text-[10px] bg-blue-600 px-4 py-2 rounded-full uppercase text-white font-bold shadow-lg">ç¡®è®¤</button>
                            </div>

                            <div className="space-y-4 p-4 bg-white/5 rounded-2xl border border-white/5">
                                <label className="text-[10px] text-slate-400 uppercase tracking-widest">è¿è¡Œç­–ç•¥</label>
                                <div className="grid grid-cols-2 gap-2 mt-2">
                                    {[{ id: 'background', label: 'é”å±å­˜æ´»', icon: 'Shield' }, { id: 'wakelock', label: 'å±å¹•å¸¸äº®', icon: 'Zap' }].map(o => (
                                        <button key={o.id} onClick={() => setSettings(s => ({ ...s, runMode: o.id }))}
                                                className={`flex flex-col items-center gap-2 p-3 rounded-xl border transition-all ${settings.runMode === o.id ? 'bg-blue-600/20 border-blue-500 text-blue-400' : 'bg-white/5 border-white/5 text-slate-500'}`}>
                                            <Icon name={o.icon} size={16}/><span className="text-[9px]">{o.label}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <div className="space-y-2 pt-4 border-t border-white/5">
                                <label className="text-[10px] text-slate-500 uppercase tracking-widest">ç¯å¢ƒéŸ³æ•ˆ</label>
                                <div className="grid grid-cols-2 gap-2 mt-2">
                                    {[{ id: 'none', label: 'å®Œå…¨å®‰é™', icon: 'Ban' }, { id: 'rain', label: 'è‡ªç„¶é›¨å£°', icon: 'CloudRain' }, { id: 'wind', label: 'ç©ºçµé£å£°', icon: 'Wind' }, { id: 'white', label: 'æŸ”å’Œå™ªéŸ³', icon: 'Waves' }].map(o => (
                                        <button key={o.id} onClick={() => setSettings(s => ({ ...s, bgType: o.id }))}
                                                className={`flex flex-col items-center gap-2 p-3 rounded-xl border transition-all ${settings.bgType === o.id ? 'bg-blue-600/20 border-blue-500 text-blue-400' : 'bg-white/5 border-white/5 text-slate-500'}`}>
                                            <Icon name={o.icon} size={16}/><span className="text-[9px]">{o.label}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <div className="space-y-2 pt-4 border-t border-white/5">
                                <label className="text-[10px] text-slate-500 uppercase tracking-widest">è½¬æŠ˜éŸ³æ•ˆ</label>
                                <div className="grid grid-cols-2 gap-2 mt-2">
                                    {[{ id: 'qing', label: 'é™å¿ƒé¢‚é’µ', icon: 'Bell' }, { id: 'muyu', label: 'ç¦…æ„æœ¨é±¼', icon: 'Drum' }, { id: 'drop', label: 'çµåŠ¨æ°´æ»´', icon: 'Droplets' }, { id: 'none', label: 'æ— éŸ³æ•ˆ', icon: 'Ban' }].map(o => (
                                        <button key={o.id} onClick={() => setSettings(s => ({ ...s, transitionSound: o.id }))}
                                                className={`flex flex-col items-center gap-2 p-3 rounded-xl border transition-all ${settings.transitionSound === o.id ? 'bg-blue-600/20 border-blue-500 text-blue-400' : 'bg-white/5 border-white/5 text-slate-500'}`}>
                                            <Icon name={o.icon} size={16}/><span className="text-[9px]">{o.label}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <div className="space-y-4 pt-4 border-t border-white/5">
                                {[{ label: 'å¸æ°” Inhale', key: 'inhale' }, { label: 'å±æ¯ Hold', key: 'hold' }, { label: 'å‘¼æ°” Exhale', key: 'exhale' }].map(item => (
                                    <div key={item.key} className="flex items-center justify-between">
                                        <label className="text-[10px] text-slate-400 uppercase tracking-widest">{item.label}</label>
                                        <div className="flex items-center gap-3">
                                            <button onClick={() => setSettings(s => ({ ...s, [item.key]: Math.max(0.5, s[item.key] - 0.5) }))} className="p-1.5 rounded-lg bg-white/5 text-slate-400 hover:text-white"><Icon name="Minus" size={12}/></button>
                                            <span className="w-8 text-center text-lg font-light tabular-nums text-white">{settings[item.key]}</span>
                                            <button onClick={() => setSettings(s => ({ ...s, [item.key]: s[item.key] + 0.5 }))} className="p-1.5 rounded-lg bg-white/5 text-slate-400 hover:text-white"><Icon name="Plus" size={12}/></button>
                                        </div>
                                    </div>
                                ))}
                            </div>

                            {/* iOS ä½¿ç”¨é¡»çŸ¥ */}
                            <div className="pt-4 border-t border-white/5 bg-amber-500/5 border border-amber-500/20 rounded-2xl p-4 space-y-2">
                                <p className="text-[9px] text-amber-400 uppercase tracking-widest font-bold">ğŸ“± iOS é”å±é¡»çŸ¥</p>
                                <p className="text-[10px] text-slate-400 leading-relaxed">1. å¼€å§‹å‰è¯·ç¡®ä¿<span className="text-white">æ‰‹æœºéŸ³é‡éé›¶</span>ï¼ˆå“ªæ€•å¾ˆå°ï¼‰<br/>2. ä¸è¦åœ¨é™éŸ³æ¨¡å¼ä¸‹ä½¿ç”¨<br/>3. é”å±æ§åˆ¶ä¸­å¿ƒä¼šæ˜¾ç¤ºåª’ä½“æ§ä»¶<br/>4. éŸ³é¢‘è®¡æ—¶åœ¨é”å±æœŸé—´æŒç»­è¿è¡Œ</p>
                            </div>

                            <div className="pt-4 border-t border-white/5 flex flex-col items-center gap-2 text-slate-600">
                                <span className="text-[9px] uppercase tracking-tighter">æ¯é“ v{APP_VERSION} Â· Dual Keep-Alive</span>
                                <button onClick={forceFullReload} className="mt-2 flex items-center gap-2 px-4 py-2 rounded-xl bg-red-600/10 text-red-500 text-[10px] uppercase tracking-widest active:scale-95 border border-red-500/20">
                                    <Icon name="RotateCw" size={12}/> å¼ºåˆ¶æ¸…é™¤ç¼“å­˜
                                </button>
                            </div>
                        </div>
                    </div>
                )}

                <style>{`
                    input[type='range']::-webkit-slider-thumb {
                        -webkit-appearance: none; height: 16px; width: 16px;
                        border-radius: 50%; background: #ffffff;
                        box-shadow: 0 0 10px rgba(59,130,246,0.5);
                        cursor: pointer; border: 2px solid #3b82f6;
                    }
                    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
                    .animate-in { animation: fadeIn 0.3s ease-out forwards; }
                `}</style>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App/>);
</script>
</body>
</html>
